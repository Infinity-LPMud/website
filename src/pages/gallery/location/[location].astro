---
import InfinityMainLayout from "../../../layouts/InfinityMainLayout.astro";
import PageHeader from "../../../components/PageHeader.astro";
import {
  getAllLocations,
  getUsersByLocation,
  getLocationBySlug,
} from "../../../lib/gallery";

export function getStaticPaths() {
  return getAllLocations().map((loc) => ({
    params: { location: loc.slug },
  }));
}

const { location } = Astro.params;
const loc = getLocationBySlug(location!);
const usersHere = getUsersByLocation(location!);
---

<InfinityMainLayout
  title={`Users in ${loc?.name}`}
  description={`Photos of Infinity MUD players from ${loc?.name}.`}
>
  <PageHeader title={`Infinity Users in ${loc?.name}`} />

  <div class="reveal">
    <p class="text-xl">
      <a href="/gallery/">&larr; Back to Gallery</a>
    </p>
  </div>

  <div class="page-section-wrapper reveal">
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
      {
        usersHere.map(({ username, user, image }) => (
          <a
            href={`/gallery/user/${username}`}
            class="gallery-thumb group"
          >
            <div class="aspect-square overflow-hidden rounded">
              <img
                src={`/user-images/images/${image.filename}`}
                alt={user.name}
                loading="lazy"
                decoding="async"
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
              />
            </div>
            <p class="gallery-thumb-caption">{user.name}</p>
          </a>
        ))
      }
    </div>
  </div>
</InfinityMainLayout>

<style>
  .gallery-thumb {
    display: block;
    background: rgba(10, 10, 18, 0.6);
    border: 1px solid rgba(212, 162, 78, 0.15);
    border-radius: 6px;
    padding: 0.5rem;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .gallery-thumb:hover {
    border-color: rgba(212, 162, 78, 0.4);
    box-shadow: 0 0 20px rgba(212, 162, 78, 0.1);
  }

  .gallery-thumb-caption {
    font-size: 0.85rem;
    color: #c8b89a;
    margin-top: 0.4rem;
    text-align: center;
    line-height: 1.3;
  }
</style>
