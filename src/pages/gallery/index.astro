---
import InfinityMainLayout from "../../layouts/InfinityMainLayout.astro";
import PageHeader from "../../components/PageHeader.astro";
import {
  getAllLocations,
  getAllUsers,
  getUsersByLocation,
  getImagesByUser,
} from "../../lib/gallery";

const locations = getAllLocations();
const users = getAllUsers();
const sortedUsernames = Object.keys(users)
  .filter((u) => getImagesByUser(u).length > 0)
  .sort();
---

<InfinityMainLayout
  title="User Gallery"
  description="Photos of Infinity MUD players from around the world, collected over the years by the community."
  noindex
  nofollow
>
  <PageHeader title="User Gallery" />

  <div class="reveal">
    <p class="text-xl">
      Over the years, Infinity's players have shared photos of themselves and
      their gatherings. This gallery is an archive of those images, organized by
      the locations our community called home.
    </p>
  </div>

  <div class="page-section-wrapper reveal">
    <h2 class="header-style section-header">Browse by Location</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mt-4">
      {
        locations.map((loc) => {
          const count = getUsersByLocation(loc.slug).length;
          return (
            <a href={`/gallery/location/${loc.slug}`} class="location-card">
              <span class="location-name">{loc.name}</span>
              <span class="location-count">
                {count} {count === 1 ? "user" : "users"}
              </span>
            </a>
          );
        })
      }
    </div>
  </div>

  <div class="page-section-wrapper reveal">
    <h2 class="header-style section-header">Browse by User</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mt-4">
      {
        sortedUsernames.map((username) => {
          const user = users[username];
          const count = getImagesByUser(username).length;
          return (
            <a href={`/gallery/user/${username}`} class="user-card">
              <span class="user-name">{user.name}</span>
              <span class="location-count">
                {count} {count === 1 ? "photo" : "photos"}
              </span>
            </a>
          );
        })
      }
    </div>
  </div>
</InfinityMainLayout>

<style>
  .location-card,
  .user-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.75rem;
    background: rgba(10, 10, 18, 0.6);
    border: 1px solid rgba(212, 162, 78, 0.15);
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.3s ease;
    text-align: center;
  }

  .location-card:hover,
  .user-card:hover {
    border-color: rgba(212, 162, 78, 0.4);
    box-shadow: 0 0 20px rgba(212, 162, 78, 0.1);
    text-shadow: none;
  }

  .location-name,
  .user-name {
    font-family: MedievalSharp, cursive;
    color: #d4a24e;
    font-size: 1.1rem;
  }

  .location-count {
    color: #8a7a6a;
    font-size: 0.75rem;
    font-family: "IM Fell English", serif;
  }
</style>
